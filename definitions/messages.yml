openapi: "3.0.0"
info:
  version: 0.3.6
  title: Messages API
  description: 'The Messaging API is a new API that consolidates all messaging channels. It encapsulates a user (developer) from having to use multiple APIs to interact with our various channels such as SMS, MMS, Viber, Facebook Messenger, etc. The API normalises information across all channels to abstracted to, from and content. This API is currently in Beta.'
  contact:
    name: Nexmo DevRel
    email: devrel@nexmo.com
    url: 'https://developer.nexmo.com/'
  x-label: Beta
servers:
  - url: https://api.nexmo.com/v0.1/messages
paths:
  /:
    post:
      security:
        - bearerAuth: []
        - basicAuth: []
      summary: Send a Message
      operationId: NewMessage
      requestBody:
        description: Send a Message.
        required: true
        x-show-example-request: true
        content:
          application/json:
            schema:
              oneOf:
                - title: SMS
                  x-tab-id: SMS
                  oneOf:
                    - allOf:
                      - $ref: '#/components/requestBodies/Text'
                      - properties:
                          text:
                            description: |
                                Limited to 1000 characters. The Messages API automatically detects unicode characters when sending SMS and sends the message as a unicode SMS. For more information on how concatenation and encoding please visit: [developer.nexmo.com/messaging/sms/guides/concatenation-and-encoding](https://developer.nexmo.com/messaging/sms/guides/concatenation-and-encoding).
                      - $ref: '#/components/schemas/channelOptionsSms'
                - title: MMS
                  x-tab-id: MMS
                  oneOf:
                    - allOf:
                      - $ref: '#/components/requestBodies/Text'
                      - $ref: '#/components/schemas/channelOptionsMms'
                    - allOf:
                      - $ref: '#/components/requestBodies/Image'
                      - properties:
                          image:
                            properties:
                              url:
                                type: string
                                description: |
                                  The URL of the image attachment.

                                  Supports `.jpg`, `.jpeg`, `.png` and `.gif`.
                                example: 'https://example.com/image.jpg'
                              caption:
                                type: string
                                description: 'Additional text to accompany the image.'
                                minLength: 1
                                maxLength: 3000
                                example: 'Additional text to accompany the image.'
                      - $ref: '#/components/schemas/channelOptionsMms'
                - title: WhatsApp
                  x-tab-id: WhatsApp
                  oneOf:
                    - allOf:
                      - $ref: '#/components/requestBodies/Text'
                      - properties:
                          text:
                            description: |
                                Limited to 4096 characters, including unicode.
                      - $ref: '#/components/schemas/channelOptionsWhatsapp'
                    - allOf:
                      - $ref: '#/components/requestBodies/Image'
                      - properties:
                          image:
                            properties:
                              url:
                                type: string
                                description: |
                                  The URL of the image attachment.

                                  Supports `.jpg`, `.jpeg`, and `.png`.
                                example: 'https://example.com/image.jpg'
                              caption:
                                type: string
                                description: 'Additional text to accompany the image.'
                                minLength: 1
                                maxLength: 3000
                                example: 'Additional text to accompany the image.'
                      - $ref: '#/components/schemas/channelOptionsWhatsapp'
                    - allOf:
                      - $ref: '#/components/requestBodies/Audio'
                      - properties:
                          audio:
                            properties:
                              url:
                                description: |
                                  The URL of the audio attachment.

                                  Supports `.aac`, `.m4a`, `.amr`, `.mp3` and `.opus`.
                      - $ref: '#/components/schemas/channelOptionsWhatsapp'
                    - allOf:
                      - $ref: '#/components/requestBodies/Video'
                      - properties:
                          video:
                            properties:
                              url:
                                description: |
                                  The URL of the video attachment.

                                  Supports `.mp4` and `.3gpp`. Note, only `H.264` video codec and `AAC` audio codec is supported.
                      - $ref: '#/components/schemas/channelOptionsWhatsapp'
                    - allOf:
                      - $ref: '#/components/requestBodies/File'
                      - properties:
                          file:
                            properties:
                              url:
                                description: |
                                  The URL of the file attachment.

                                  Supports supports a wide range of attachments including `.zip`, `.csv` and `.pdf`.
                              caption:
                                type: string
                                description: Additional text to accompany the file.
                                example: Additional text.

                      - $ref: '#/components/schemas/channelOptionsWhatsapp'
                    - allOf:
                      - $ref: '#/components/requestBodies/Template'
                      - $ref: '#/components/schemas/channelOptionsWhatsapp'
                - title: Messenger
                  x-tab-id: Messenger
                  oneOf:
                    - allOf:
                      - $ref: '#/components/requestBodies/Text'
                      - properties:
                          text:
                            description: |
                              Limited to 640 characters, including unicode.
                      - $ref: '#/components/schemas/channelOptionsMessenger'
                    - allOf:
                      - $ref: '#/components/requestBodies/Image'
                      - properties:
                          image:
                            properties:
                              url:
                                type: string
                                description: |
                                  The URL of the image attachment.

                                  Supports `.jpg`, `.jpeg`, `.png` and `.gif`.
                                example: 'https://example.com/image.jpg'
                      - $ref: '#/components/schemas/channelOptionsMessenger'
                    - allOf:
                      - $ref: '#/components/requestBodies/Audio'
                      - properties:
                          audio:
                            properties:
                              url:
                                description: |
                                    The URL of the audio attachment.

                                    Only supports `.mp3` files
                      - $ref: '#/components/schemas/channelOptionsMessenger'
                    - allOf:
                      - $ref: '#/components/requestBodies/Video'
                      - properties:
                          video:
                            properties:
                              url:
                                description: |
                                  The URL of the video attachment.

                                  Supports `.mp4` files. Note, only `H.264` video codec and `AAC` audio codec is supported.
                      - $ref: '#/components/schemas/channelOptionsMessenger'
                    - allOf:
                      - $ref: '#/components/requestBodies/File'
                      - properties:
                          file:
                            properties:
                              url:
                                description: |
                                  The URL of the file attachment.

                                  Supports supports a wide range of attachments including `.pdf`, `.doc`, `.ppt(x)` and `.xls`.
                      - $ref: '#/components/schemas/channelOptionsMessenger'
                    - allOf:
                      - $ref: '#/components/requestBodies/Template'
                      - $ref: '#/components/schemas/channelOptionsMessenger'
                - title: Viber
                  x-tab-id: Viber
                  oneOf:
                    - allOf:
                      - $ref: '#/components/requestBodies/Text'
                      - properties:
                          text:
                            description: |
                              Limited to 1000 characters, including unicode.
                      - $ref: '#/components/schemas/channelOptionsViber'
                    - allOf:
                      - $ref: '#/components/requestBodies/Image'
                      - properties:
                          image:
                            properties:
                              url:
                                type: string
                                description: |
                                  The URL of the image attachment.

                                  Supports `.jpg`, `.jpeg`, and `.png`.
                                example: 'https://example.com/image.jpg'
                      - $ref: '#/components/schemas/channelOptionsViber'
      responses:
        '202':
          description: Accepted.
          content:
            application/json:
              schema:
                type: object
                oneOf:
                  - description: SMS
                    x-tab-id: SMS
                    type: object
                    properties:
                      message_uuid:
                        $ref: '#/components/responses/MessageUuid'
                  - description: MMS
                    x-tab-id: MMS
                    type: object
                    properties:
                      message_uuid:
                        $ref: '#/components/responses/MessageUuid'
                  - description: WhatsApp
                    x-tab-id: WhatsApp
                    type: object
                    properties:
                      message_uuid:
                        $ref: '#/components/responses/MessageUuid'
                  - description: Messenger
                    x-tab-id: Messenger
                    type: object
                    properties:
                      message_uuid:
                        $ref: '#/components/responses/MessageUuid'
                  - description: Viber
                    x-tab-id: Viber
                    type: object
                    properties:
                      message_uuid:
                        $ref: '#/components/responses/MessageUuid'
        '400':
          description: Bad Request.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/Error'
      callbacks:
        message-status:
          '{$request.body#/callback}':
            post:
              summary: Message Status
              operationId: message-status
              x-example-path: '/webhooks/message-status'
              description: 'Webhooks to inform about events happening to the message at communication level (has it been delivered, rejected by the provider...).'
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      oneOf:
                        - $ref: '#/components/schemas/messageStatusSMS'
                        - $ref: '#/components/schemas/messageStatusMMS'
                        - $ref: '#/components/schemas/messageStatusWhatsApp'
                        - $ref: '#/components/schemas/messageStatusMessenger'
                        - $ref: '#/components/schemas/messageStatusViber'
              responses:
                  '200':
                    description: Your server returns this code if it accepts the callback.
        inbound-message:
          '{$request.body#/callback}':
            post:
              summary: Inbound Message
              operationId: inbound-message
              x-example-path: '/webhooks/inbound-message'
              description: An inbound message from a customer to you.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      $ref: '#/components/schemas/InboundMessage'
              responses:
                  '200':
                    description: Your server returns this code if it accepts the callback.


components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    basicAuth:
      type: http
      scheme: basic

  schemas:
    ToNumber:
      type: string
      minLength: 1
      maxLength: 50
      example: '447700900000'
      description: |
           The phone number of the message **recipient** in the [E.164](https://en.wikipedia.org/wiki/E.164) format. Don't use a leading + or 00 when entering a phone number, start with the country code, for example, 447700900000.
    FromNumber:
      type: string
      minLength: 1
      maxLength: 50
      example: '447700900001'
      description: |
           The phone number of the message **sender** in the [E.164](https://en.wikipedia.org/wiki/E.164) format. Don't use a leading + or 00 when entering a phone number, start with the country code, for example, 447700900000.
    ToId:
      type: string
      minLength: 1
      maxLength: 50
      example: '0123456789012345'
      description: |
          The ID of the message recipient
    FromId:
      type: string
      minLength: 1
      maxLength: 50
      example: '9876543210'
      description: |
          The ID of the message sender

    baseMessageType:
      type: object
      required:
        - to
        - from
        - message
        - type
        - channel
      properties:
        client_ref:
          type: string
          description: Client reference of up to 40 characters. The reference will be present in every message status.

    channelOptionsSms:
      type: object
      properties:
        to:
          $ref: "#/components/schemas/ToNumber"
        from:
          $ref: "#/components/schemas/FromNumber"
        channel:
          type: string
          description: The channel to send to. You must provide `sms` in this field
          example: sms
          enum:
            - sms

    channelOptionsMms:
      type: object
      properties:
        to:
          $ref: "#/components/schemas/ToNumber"
        from:
          $ref: "#/components/schemas/FromNumber"
        channel:
          type: string
          description: The channel to send to. You must provide `mms` in this field
          example: mms
          enum:
            - mms

    channelOptionsMessenger:
      type: object
      properties:
        to:
          $ref: "#/components/schemas/ToId"
        from:
          $ref: "#/components/schemas/FromId"
        channel:
          description: The channel to send to. You must provide `messenger` in this field
          type: string
          example: messenger
          enum:
            - messenger
        messenger:
          type: object
          properties:
            category:
              type: string
              enum:
                - response
                - update
                - message_tag
            tag:
              type: string

    channelOptionsViber:
      type: object
      properties:
        to:
          $ref: "#/components/schemas/ToNumber"
        from:
          $ref: "#/components/schemas/FromId"
        channel:
          description: The channel to send to. You must provide `viber_service` in this field
          type: string
          example: viber_service
          enum:
            - viber_service
        viber_service:
          type: object
          properties:
            category:
              type: string
              enum:
                - transaction
                - promotion
            ttl:
              type: integer
            type:
              type: string

    channelOptionsWhatsapp:
      type: object
      properties:
        to:
          $ref: "#/components/schemas/ToNumber"
        from:
          $ref: "#/components/schemas/FromNumber"
        channel:
          description: The channel to send to. You must provide `whatsapp` in this field
          type: string
          example: whatsapp
          enum:
            - whatsapp
        whatsapp:
          type: object
          properties:
            policy:
              type: string
              example: deterministic
              enum:
                - fallback
                - deterministic
              description: 'Please note that WhatsApp will deprecate `fallback` policy in January 2020. There are two policies that you can specify when sending a Message Template: `deterministic` and `fallback`. `deterministic` — Deliver the Message Template in exactly the language and locale asked for. `fallback` — Deliver the Message Template in the language that matches users language/locale setting on device. If one can not be found, deliver using the specified fallback language.'
            locale:
              type: string
              example: en-US
              description: 'We are using the industry standard, BCP 47, for locales. So in your API call to the /messages API you will need to put `en-GB` and this will refer to the `en_GB` template for WhatsApp. A full list of the possible locales is available on [developers.facebook.com](https://developers.facebook.com/docs/whatsapp/message-templates/creation#translations).'


    messageStatusBase:
      type: object
      properties:
        message_uuid:
          $ref: "#/components/responses/MessageUuid"
        to:
          $ref: "#/components/schemas/ToNumber"
        from:
          $ref: "#/components/schemas/FromNumber"
        timestamp:
          type: string
          description: The datetime of when the event occurred, in `ISO 8601` format.
          example: 2020-01-01T14:00:00.000Z
        status:
          type: string
          description: The status of the message.
          example: submitted
          enum:
            - submitted
            - delivered
            - rejected
            - undeliverable
      required:
        - message_uuid
        - channel
        - to
        - from
        - timestamp
        - status
    messageStatusSMS:
      allOf:
        - $ref: "#/components/schemas/messageStatusBase"
        - title: SMS
          x-tab-id: status_SMS
          description: SMS
          properties:
            channel:
              type: string
              description: The channel sending to.
              example: sms
              enum:
                - sms
    messageStatusMMS:
      allOf:
        - $ref: "#/components/schemas/messageStatusBase"
        - title: MMS
          x-tab-id: status_MMS
          description: MMS
          properties:
            channel:
              type: string
              description: The channel sending to.
              example: mms
              enum:
                - mms
    messageStatusWhatsApp:
      allOf:
        - $ref: "#/components/schemas/messageStatusBase"
        - title: WhatsApp
          x-tab-id: status_WhatsApp
          description: WhatsApp
          properties:
            channel:
              type: string
              description: The channel sending to.
              example: whatsapp
              enum:
                - whatsapp
            status:
              example: read
              enum:
                - submitted
                - delivered
                - rejected
                - undeliverable
                - read
    messageStatusMessenger:
      allOf:
        - $ref: "#/components/schemas/messageStatusBase"
        - title: Messenger
          x-tab-id: status_Messenger
          description: Messenger
          properties:
            channel:
              type: string
              description: The channel sending to.
              example: messenger
              enum:
                - messenger
            status:
              example: read
              enum:
                - submitted
                - delivered
                - rejected
                - undeliverable
                - read
            to:
              $ref: "#/components/schemas/ToId"
              description: |
                The ID of the message recipient. 
                
                This value should be the `from.id` value you received in the inbound messenger event.
            from:
              $ref: "#/components/schemas/FromId"
              description: |
                Your ID for the platform that you are sending from.

                This value should be the `to.id` value you received in the inbound messenger event.

    messageStatusViber:
      allOf:
        - $ref: "#/components/schemas/messageStatusBase"
        - title: Viber
          x-tab-id: status_Viber
          description: Viber
          properties:
            channel:
              type: string
              description: The channel sending to.
              example: viber_service
              enum:
                - viber_service
            status:
              example: read
              enum:
                - submitted
                - delivered
                - rejected
                - undeliverable
                - read
    

    InboundMessage:
      type: object
      properties:
        message_uuid:
          type: string
          example: 'aaaaaaaa-bbbb-cccc-dddd-0123456789ab'
          description: The UUID of the message.
      required:
        - message_uuid
        - to
        - from
        - timestamp

  requestBodies:
    Text:
      allOf:
        - $ref: "#/components/schemas/baseMessageType"
        - title: Text
          x-tab-id: Text
          description: Text
          required:
            - text
          properties:
            type:
              type: string
              enum:
                - text
              example: text
              description: The type of message to send. You must provide `text` in this field
            text:
              type: string
              example: 'Nexmo Verification code: 64873.<br />Valid for 10 minutes.'

    Image:
      allOf:
        - $ref: "#/components/schemas/baseMessageType"
        - title: Image
          x-tab-id: Image
          type: object
          required:
            - image
          properties:
            type:
              type: string
              enum:
                - image
              example: image
              description: The type of message to send. You must provide `image` in this field
            image:
              type: object
              properties:
                url:
                  type: string

    Audio:
      allOf:
        - $ref: "#/components/schemas/baseMessageType"
        - title: Audio
          x-tab-id: Audio
          type: object
          required:
            - audio
          properties:
            type:
              type: string
              enum:
                - audio
              example: audio
              description: The type of message to send. You must provide `audio` in this field
            audio:
              type: object
              properties:
                url:
                  type: string
                  minLength: 10
                  maxLength: 2000
                  example: 'https://example.com/audio.mp3'

    Video:
      allOf:
        - $ref: "#/components/schemas/baseMessageType"
        - title: Video
          x-tab-id: Video
          type: object
          required:
            - video
          properties:
            type:
              type: string
              enum:
                - video
              example: video
              description: The type of message to send. You must provide `video` in this field
            video:
              type: object
              properties:
                url:
                  type: string
                  example: 'https://example.com/video.mp4'

    File:
      allOf:
        - $ref: "#/components/schemas/baseMessageType"
        - title: File
          x-tab-id: File
          type: object
          required:
            - file
          properties:
            type:
              type: string
              enum:
                - file
              example: file
              description: The type of message to send. You must provide `file` in this field
            file:
              type: object
              properties:
                url:
                  type: string
                  example: 'https://example.com/file.pdf'

    Template:
      allOf:
        - $ref: "#/components/schemas/baseMessageType"
        - title: Template
          x-tab-id: Template
          type: object
          required:
            - template
          properties:
            type:
              type: string
              enum:
                - template
              example: template
              description: The type of message to send. You must provide `template` in this field
            template:
              type: object
              properties:
                name:
                  type: string
                parameters:
                  type: array
                  items:
                    type: object

  responses:
    MessageUuid:
      type: string
      example: aaaaaaaa-bbbb-cccc-dddd-0123456789ab
      description: The UUID of the message
    Error:
      description: 'The error format is standardized to the 4xx/5xx range with a code and a human readable explanation.'
      required:
        - type
        - title
        - detail
        - instance
      properties:
        type:
          type: string
          example: 'https://www.nexmo.com/messages/Errors#InvalidParams'
        title:
          type: string
          example: 'Invalid Parameters'
        detail:
          type: string
          example: 'Your request parameters did not validate.'
        instance:
          type: string
          example: f94b4e56604e07e5e5ad5a7228618f81
